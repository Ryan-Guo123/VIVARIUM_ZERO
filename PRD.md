roject: VIVARIUM ZERO - Product Requirements Document (PRD)
**Version:** 1.0
**Owner:** Ryan (Founder)
**Role:** CTO (AI)
**Target Platform:** Mac mini (ARM64/Ubuntu) + Web Client

---

## 1. 产品愿景 (Executive Summary)
VIVARIUM ZERO 是一个基于 **Mac mini Home Lab** 运行的、全天候在线的**人工生命模拟系统**。
它的核心差异化在于：生物不仅进化参数，更**进化代码逻辑**（Genetic Programming）。通过在虚拟汇编环境中的自我改写，生物将从单细胞逻辑涌现出人类未曾设想的生存策略。用户拥有“上帝视角”，可随时回档时间，观测并干预进化的进程。

---

## 2. 核心世界观与物理法则 (Core Mechanics)

### 2.1 能量经济学 (The Economy)
* **混合供能机制 (Hybrid Energy):**
    * **光合作用 (Passive):** 所有生物每秒自动获得少量能量（+0.5/s）。这允许“不动”的策略存在。
    * **进食 (Scavenging):** 地图随机生成高能食物粒子（+20/ea）。
    * **捕食 (Predation):** 攻击其他生物，可掠夺对方 50% 的当前能量。
* **代谢成本 (Entropy):**
    * **存在税:** 活着就要扣血（-0.2/s）。
    * **复杂度税:** 身上长的器官越多（代码越长、传感器越多），扣血越快。
    * **死亡判定:** 能量 <= 0 时，生物死亡，尸体化为高能食物留在原地（滋养后代）。

### 2.2 空间拓扑 (Topology)
* **有界宇宙 (Petri Dish):**
    * 地图是一个封闭的 2D 矩形。
    * **物理碰撞:** 碰到墙壁会反弹。
    * **战术意义:** 允许生物进化出“利用角落防御后背”的高级战术。

### 2.3 战斗法则 (Combat System)
* **自由开火权:** 系统不强制生物攻击，也不禁止攻击。
* **进化组件:** “攻击刺”是一个可进化的输出端口。只有进化出这个器官的生物才能造成伤害。
* **伤害计算:** 伤害值 = 攻击者力量 - 防御者护甲。

---

## 3. 进化引擎架构 (Evolutionary Engine)

这是本项目的技术核心。我们不直接进化神经网络权重，我们进化**逻辑指令树**。

### 3.1 虚拟基因 (The Genome)
每个生物拥有一个“基因磁带”，里面记录了一串**虚拟汇编指令**：
* **Sensors (输入):** `SEE_FOOD` (视觉), `SEE_WALL` (距离), `MY_ENERGY` (自感).
* **Logic (处理):** `IF`, `JUMP` (跳转), `ADD`, `SUB`, `MEMORY_SET` (记忆).
* **Actions (输出):** `MOVE_FWD` (前进), `ROTATE` (转弯), `ATTACK` (攻击), `SPLIT` (繁殖).

### 3.2 突变机制 (Mutation Logic)
当生物能量满额进行繁殖（分裂）时，子代代码会发生以下突变：
1.  **位点翻转:** 把 `MOVE_FWD` 变成了 `MOVE_BACK`。
2.  **插入指令:** 在代码中间随机插了一句 `IF ENERGY < 10`。
3.  **逻辑删除:** 随机删掉了一段代码（可能导致它变傻，也可能变得更高效）。

---

## 4. 系统架构设计 (System Architecture)

### 4.1 硬件层 (Mac mini)
* **OS:** Ubuntu Server 24.04 (ARM64).
* **Container:** Docker 容器化部署，确保环境隔离，随时重置。
* **Management:** 通过 **XPipe** 进行远程 SSH 管理和 Docker 监控。

### 4.2 后端 (Server - Python/FastAPI)
* **Core Loop:** 使用 Numba 加速的物理引擎，负责计算碰撞、能量流转。
* **VM Interpreter:** 自研的轻量级解释器，每秒执行数万次生物的基因指令。
* **Time Machine (DB):**
    * 使用 SQLite + JSON 快照。
    * **Cron Job:** 每 5 分钟自动保存一次完整世界快照（Snapshot）。
    * **Hot Reload:** 接收到回档指令后，立即清空内存，重新加载历史数据。

### 4.3 前端 (Client - Web/p5.js)
* **Visualizer (表现层):**
    * 使用 **Phenotype Visualization**（表型可视化）。
    * **攻击型:** 身体呈红色，带有尖刺几何体。
    * **感知型:** 身体周围有光晕（代表传感器范围）。
    * **复杂型:** 尾部拖尾长度代表其代码的行数（智商）。
* **Dashboard (控制层):**
    * **上帝滑块:** 实时调整 `食物生成率`、`突变率`。
    * **时间轴:** 底部滚动条，点击任意时间点即可“穿越”回去。

---

## 5. 开发路线图 (Roadmap)

### Phase 1: 创世纪 (Genesis) - *Current Target*
* **目标:** 搭建好 Ubuntu + Docker 环境，跑通第一个“红点吃绿点”的 Demo。
* **功能:** 只有移动和进食，没有战斗，没有复杂代码进化。
* **交付物:** 一个可以在你 MacBook 上通过浏览器访问的 Localhost 网址。

### Phase 2: 寒武纪大爆发 (The Explosion)
* **目标:** 引入“虚拟汇编解释器”。
* **功能:** 生物开始长出不同的形状，学会简单的条件反射（有墙就转弯）。
* **交付物:** 能够看到生物出现明显的行为分化。

### Phase 3: 时间领主 (Time Lord)
* **目标:** 实装数据库和回档功能。
* **功能:** 网页端增加时间轴，后台实现自动备份。

---

## 6. 风险与对策 (Risk Analysis)

| 风险点 | 描述 | 解决方案 |
| :--- | :--- | :--- |
| **死循环** | 生物进化出了 `WHILE(TRUE)` 代码，导致 CPU 100% 卡死。 | **Gas Fee 机制:** 给每只生物分配“计算力配额”。每回合只能执行 50 条指令，超支强制休眠。 |
| **人口爆炸** | 繁殖太快，内存溢出。 | **环境承载力上限:** 当数量 > 500 时，全局降低光合作用效率，制造饥荒。 |
| **进化停滞** | 生物找到一个无脑策略后不再进化。 | **动态灾难:** 每隔 1000 代触发一次随机灾难（如“冰河世纪”），强迫重新适应。 |

---
